From ltsi-dev-bounces@lists.linuxfoundation.org Tue Jun 26 04:10:44 2012
From: Tetsuyuki Kobayashi <koba@kmckk.co.jp>
Date: Tue, 26 Jun 2012 20:10:41 +0900
Subject: [LTSI-dev] [PATCH 2/4] LSTI: backport: ARM: mach-shmobile: kzm9g: add external USB Host support
To: ltsi-dev@lists.linuxfoundation.org
Cc: kuninori.morimoto.gx@gmail.com
Message-ID: <4FE998B1.1050308@kmckk.co.jp>


This is backport of
commit dd818180f9303eed270513e8ccd4516bb3a577f5

Signed-off-by: Tetsuyuki Kobayashi <koba@kmckk.co.jp>
---
 arch/arm/mach-shmobile/board-kzm9g.c |   31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/arch/arm/mach-shmobile/board-kzm9g.c b/arch/arm/mach-shmobile/board-kzm9g.c
index 35af2f8..297cda9 100644
--- a/arch/arm/mach-shmobile/board-kzm9g.c
+++ b/arch/arm/mach-shmobile/board-kzm9g.c
@@ -31,6 +31,7 @@
 #include <linux/mfd/tmio.h>
 #include <linux/platform_device.h>
 #include <linux/smsc911x.h>
+#include <linux/usb/r8a66597.h>
 #include <linux/videodev2.h>
 #include <sound/sh_fsi.h>
 #include <sound/simple_card.h>
@@ -92,6 +93,35 @@ static struct platform_device smsc_device = {
 	.num_resources	= ARRAY_SIZE(smsc9221_resources),
 };
 
+/* USB external chip */
+static struct r8a66597_platdata usb_host_data = {
+	.on_chip	= 0,
+	.xtal		= R8A66597_PLATDATA_XTAL_48MHZ,
+};
+
+static struct resource usb_resources[] = {
+	[0] = {
+		.start	= 0x10010000,
+		.end	= 0x1001ffff - 1,
+		.flags	= IORESOURCE_MEM,
+	},
+	[1] = {
+		.start	= intcs_evt2irq(0x220), /* IRQ1 */
+		.flags	= IORESOURCE_IRQ,
+	},
+};
+
+static struct platform_device usb_host_device = {
+	.name	= "r8a66597_hcd",
+	.dev = {
+		.platform_data		= &usb_host_data,
+		.dma_mask		= NULL,
+		.coherent_dma_mask	= 0xffffffff,
+	},
+	.num_resources	= ARRAY_SIZE(usb_resources),
+	.resource	= usb_resources,
+};
+
 /* LCDC */
 static struct fb_videomode kzm_lcdc_mode = {
 	.name		= "WVGA Panel",
@@ -330,6 +360,7 @@ static struct i2c_board_info i2c3_devices[] = {
 
 static struct platform_device *kzm_devices[] __initdata = {
 	&smsc_device,
+	&usb_host_device,
 	&lcdc_device,
 	&mmc_device,
 	&sdhi0_device,
-- 
1.7.9.5


_______________________________________________
LTSI-dev mailing list
LTSI-dev@lists.linuxfoundation.org
https://lists.linuxfoundation.org/mailman/listinfo/ltsi-dev

